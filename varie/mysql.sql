LOCK TABLES `proc` WRITE;
/*!40000 ALTER TABLE `proc` DISABLE KEYS */;
INSERT INTO `proc` VALUES ('socket','insertMsg','PROCEDURE','insertMsg','SQL','CONTAINS_SQL','NO','DEFINER','in_device_num INT, in_ch_num INT, in_id_analog INT,in_id_digital INT, in_msg CHAR(50)','','BEGIN\nDECLARE finito INT default 0;\nDECLARE messg VARCHAR(50);\nDECLARE a INT;\nDECLARE cur1 CURSOR FOR SELECT msg FROM alarm_ack WHERE id_analog=in_id_analog AND id_digital=in_id_digital ORDER BY id DESC LIMIT 1;\nDECLARE CONTINUE HANDLER FOR SQLSTATE \'02000\' SET finito = 1;\nOPEN cur1;\nFETCH cur1 INTO messg;\nCLOSE cur1;\nIF STRCMP(messg,in_msg)!=0 OR finito=1 THEN INSERT INTO alarm_ack(data,device_num,ch_num,id_analog,id_digital,msg) VALUES(now(),in_device_num,in_ch_num,in_id_analog,in_id_digital,in_msg);\nEND IF;\nEND','root@localhost','2011-09-02 07:31:58','2011-09-02 07:31:58','','','utf8','utf8_general_ci','latin1_swedish_ci','BEGIN\nDECLARE finito INT default 0;\nDECLARE messg VARCHAR(50);\nDECLARE a INT;\nDECLARE cur1 CURSOR FOR SELECT msg FROM alarm_ack WHERE id_analog=in_id_analog AND id_digital=in_id_digital ORDER BY id DESC LIMIT 1;\nDECLARE CONTINUE HANDLER FOR SQLSTATE \'02000\' SET finito = 1;\nOPEN cur1;\nFETCH cur1 INTO messg;\nCLOSE cur1;\nIF STRCMP(messg,in_msg)!=0 OR finito=1 THEN INSERT INTO alarm_ack(data,device_num,ch_num,id_analog,id_digital,msg) VALUES(now(),in_device_num,in_ch_num,in_id_analog,in_id_digital,in_msg);\nEND IF;\nEND');
/*!40000 ALTER TABLE `proc` ENABLE KEYS */;
UNLOCK TABLES;

